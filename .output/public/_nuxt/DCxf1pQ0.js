import{_ as P}from"./Ce8Rj96Y.js";import{g as C,o as n,c as d,a as e,l,t as m,k as p,p as x,d as f,q as _,v as S,s as w,x as j,F as D,r as R,b as h,w as B,y as T,z as U,A as V}from"./CCdD_pZz.js";const N={class:"space-y-4"},E={key:0,class:"text-sm text-red-600"},L={key:1,class:"relative"},q=["src"],z=C({__name:"ImageUpload",emits:["update:imageUrl","error"],setup($,{expose:g,emit:r}){const o=x(null),i=x(null),u=x(""),b=r,k=a=>{const c=a.target.files?.[0];if(!c)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(c.type)){u.value="Invalid file type. Only JPG, PNG, and WEBP are allowed.",b("error",u.value);return}const s=5*1024*1024;if(c.size>s){u.value="File size must be under 5MB.",b("error",u.value);return}u.value="",o.value=c;const F=new FileReader;F.onload=M=>{i.value=M.target?.result},F.readAsDataURL(c)},v=()=>{o.value=null,i.value=null,u.value=""};return g({selectedFile:o,clearSelection:v}),(a,t)=>(n(),d("div",N,[e("div",null,[t[0]||(t[0]=e("label",{for:"image-upload",class:"block text-sm font-medium text-gray-700 mb-2"}," Photo Evidence (optional) ",-1)),e("input",{id:"image-upload",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",onChange:k},null,32),t[1]||(t[1]=e("p",{class:"mt-1 text-xs text-gray-500"}," JPG, PNG, or WEBP. Max 5MB. ",-1))]),l(u)?(n(),d("div",E,m(l(u)),1)):p("",!0),l(i)?(n(),d("div",L,[e("img",{src:l(i),alt:"Preview",class:"w-full h-48 object-cover rounded-lg"},null,8,q),e("button",{type:"button",class:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors",onClick:v},[...t[2]||(t[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):p("",!0)]))}}),I=Object.assign(z,{__name:"ImageUpload"}),O={key:0,class:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg"},G={key:0,class:"mt-1 text-sm text-red-600"},W={key:0,class:"mt-1 text-sm text-red-600"},A=["value"],J={key:0,class:"mt-1 text-sm text-red-600"},H={key:0,class:"mt-1 text-sm text-red-600"},K={class:"flex gap-4"},Q=["disabled"],X=C({__name:"ComplaintForm",setup($){const g=x(null),r=U({title:"",body:"",category:"",location:""}),o=U({title:"",body:"",category:"",location:"",general:""}),i=x(!1),u=[{value:"roads",label:"Roads"},{value:"water",label:"Water"},{value:"electricity",label:"Electricity"},{value:"sanitation",label:"Sanitation"}],b=()=>{o.title="",o.body="",o.category="",o.location="",o.general=""},k=()=>{b();let a=!0;return r.title.trim()||(o.title="Title is required",a=!1),r.body.trim()||(o.body="Description is required",a=!1),r.category||(o.category="Category is required",a=!1),r.location.trim()||(o.location="Location is required",a=!1),a},v=async()=>{if(k()){i.value=!0,b();try{let a;const t=g.value,c=t?.selectedFile?l(t.selectedFile):null;if(c){const y=new FormData;y.append("image",c),a=(await $fetch("/api/upload",{method:"POST",body:y})).url}await $fetch("/api/complaints",{method:"POST",body:{title:r.title,body:r.body,category:r.category,location:r.location,imageUrl:a}}),r.title="",r.body="",r.category="",r.location="",g.value?.clearSelection(),await V("/")}catch(a){console.error("Error submitting complaint:",a),o.general=a.data?.message||"Failed to submit complaint. Please try again."}finally{i.value=!1}}};return(a,t)=>{const c=I,y=P;return n(),d("form",{onSubmit:T(v,["prevent"]),class:"space-y-6"},[l(o).general?(n(),d("div",O,m(l(o).general),1)):p("",!0),e("div",null,[t[4]||(t[4]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[f(" Title "),e("span",{class:"text-red-500"},"*")],-1)),_(e("input",{id:"title","onUpdate:modelValue":t[0]||(t[0]=s=>l(r).title=s),type:"text",class:w(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":l(o).title}]),placeholder:"Brief summary of the issue"},null,2),[[S,l(r).title]]),l(o).title?(n(),d("p",G,m(l(o).title),1)):p("",!0)]),e("div",null,[t[5]||(t[5]=e("label",{for:"body",class:"block text-sm font-medium text-gray-700 mb-2"},[f(" Description "),e("span",{class:"text-red-500"},"*")],-1)),_(e("textarea",{id:"body","onUpdate:modelValue":t[1]||(t[1]=s=>l(r).body=s),rows:"5",class:w(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":l(o).body}]),placeholder:"Detailed description of the complaint"},null,2),[[S,l(r).body]]),l(o).body?(n(),d("p",W,m(l(o).body),1)):p("",!0)]),e("div",null,[t[7]||(t[7]=e("label",{for:"category",class:"block text-sm font-medium text-gray-700 mb-2"},[f(" Category "),e("span",{class:"text-red-500"},"*")],-1)),_(e("select",{id:"category","onUpdate:modelValue":t[2]||(t[2]=s=>l(r).category=s),class:w(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":l(o).category}])},[t[6]||(t[6]=e("option",{value:""},"Select a category",-1)),(n(),d(D,null,R(u,s=>e("option",{key:s.value,value:s.value},m(s.label),9,A)),64))],2),[[j,l(r).category]]),l(o).category?(n(),d("p",J,m(l(o).category),1)):p("",!0)]),e("div",null,[t[8]||(t[8]=e("label",{for:"location",class:"block text-sm font-medium text-gray-700 mb-2"},[f(" Location "),e("span",{class:"text-red-500"},"*")],-1)),_(e("input",{id:"location","onUpdate:modelValue":t[3]||(t[3]=s=>l(r).location=s),type:"text",class:w(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":l(o).location}]),placeholder:"Street address or area name"},null,2),[[S,l(r).location]]),l(o).location?(n(),d("p",H,m(l(o).location),1)):p("",!0)]),h(c,{ref_key:"imageUploadRef",ref:g},null,512),e("div",K,[e("button",{type:"submit",disabled:l(i),class:"flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"},m(l(i)?"Submitting...":"Submit Complaint"),9,Q),h(y,{to:"/",class:"px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors"},{default:B(()=>[...t[9]||(t[9]=[f(" Cancel ",-1)])]),_:1})])],32)}}}),Y=Object.assign(X,{__name:"ComplaintForm"}),Z={class:"min-h-screen"},ee={class:"bg-white shadow-sm"},te={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},oe={class:"flex items-center gap-4"},le={class:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},re={class:"bg-white shadow-md rounded-lg p-6 md:p-8"},ie=C({__name:"submit",setup($){return(g,r)=>{const o=P,i=Y;return n(),d("div",Z,[e("header",ee,[e("div",te,[e("div",oe,[h(o,{to:"/",class:"text-gray-600 hover:text-gray-900 transition-colors"},{default:B(()=>[...r[0]||(r[0]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1}),r[1]||(r[1]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Submit Complaint"),e("p",{class:"text-gray-600 mt-1"},"Report a civic issue in your community")],-1))])])]),e("main",le,[e("div",re,[h(i)])])])}}});export{ie as default};
