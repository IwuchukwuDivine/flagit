import{_ as F}from"./CUgHxEN-.js";import{g as U,o as i,c as n,a as e,l as r,t as m,k as g,p as v,d as b,q as y,v as h,s as x,x as M,F as V,r as j,b as w,w as P,y as D,z as $,A as T,_ as R}from"./D5h3QCEn.js";const E={class:"space-y-4"},L={key:0,class:"text-sm text-red-600"},q={key:1,class:"relative"},z=["src"],I=U({__name:"ImageUpload",emits:["update:imageUrl","error"],setup(N,{expose:d,emit:a}){const t=v(null),c=v(null),u=v(""),f=a,k=l=>{const p=l.target.files?.[0];if(!p)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(p.type)){u.value="Invalid file type. Only JPG, PNG, and WEBP are allowed.",f("error",u.value);return}const s=5*1024*1024;if(p.size>s){u.value="File size must be under 5MB.",f("error",u.value);return}u.value="",t.value=p;const C=new FileReader;C.onload=B=>{c.value=B.target?.result},C.readAsDataURL(p)},_=()=>{t.value=null,c.value=null,u.value=""};return d({selectedFile:t,clearSelection:_}),(l,o)=>(i(),n("div",E,[e("div",null,[o[0]||(o[0]=e("label",{for:"image-upload",class:"block text-sm font-medium text-gray-700 mb-2"}," Photo Evidence (optional) ",-1)),e("input",{id:"image-upload",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",onChange:k},null,32),o[1]||(o[1]=e("p",{class:"mt-1 text-xs text-gray-500"}," JPG, PNG, or WEBP. Max 5MB. ",-1))]),r(u)?(i(),n("div",L,m(r(u)),1)):g("",!0),r(c)?(i(),n("div",q,[e("img",{src:r(c),alt:"Preview",class:"w-full h-48 object-cover rounded-lg"},null,8,z),e("button",{type:"button",class:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors",onClick:_},[...o[2]||(o[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):g("",!0)]))}}),O=Object.assign(I,{__name:"ImageUpload"}),G={key:0,class:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg"},W={key:0,class:"mt-1 text-sm text-red-600"},Y={key:0,class:"mt-1 text-sm text-red-600"},A={key:0,class:"mt-1 text-sm text-red-600"},J=["value"],H={key:0,class:"mt-1 text-sm text-red-600"},K={key:0,class:"mt-1 text-sm text-red-600"},Q={class:"flex gap-4"},X=["disabled"],Z=U({__name:"ComplaintForm",setup(N){const d=v(null),a=$({title:"",body:"",authorName:"",category:"",location:""}),t=$({title:"",body:"",authorName:"",category:"",location:"",general:""}),c=v(!1),u=[{value:"roads",label:"Roads"},{value:"water",label:"Water"},{value:"electricity",label:"Electricity"},{value:"sanitation",label:"Sanitation"}],f=()=>{t.title="",t.body="",t.authorName="",t.category="",t.location="",t.general=""},k=()=>{f();let l=!0;return a.title.trim()||(t.title="Title is required",l=!1),a.body.trim()||(t.body="Description is required",l=!1),a.authorName.trim()||(t.authorName="Your name is required",l=!1),a.category||(t.category="Category is required",l=!1),a.location.trim()||(t.location="Location is required",l=!1),l},_=async()=>{if(k()){c.value=!0,f();try{let l;if(d.value?.selectedFile?.value){const o=new FormData;o.append("image",d.value.selectedFile.value),l=(await $fetch("/api/upload",{method:"POST",body:o})).url}await $fetch("/api/complaints",{method:"POST",body:{title:a.title,body:a.body,authorName:a.authorName,category:a.category,location:a.location,imageUrl:l}}),a.title="",a.body="",a.authorName="",a.category="",a.location="",d.value?.clearSelection(),await T("/")}catch(l){console.error("Error submitting complaint:",l),t.general=l.data?.message||"Failed to submit complaint. Please try again."}finally{c.value=!1}}};return(l,o)=>{const p=O,S=F;return i(),n("form",{onSubmit:D(_,["prevent"]),class:"space-y-6"},[r(t).general?(i(),n("div",G,m(r(t).general),1)):g("",!0),e("div",null,[o[5]||(o[5]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Title "),e("span",{class:"text-red-500"},"*")],-1)),y(e("input",{id:"title","onUpdate:modelValue":o[0]||(o[0]=s=>r(a).title=s),type:"text",class:x(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":r(t).title}]),placeholder:"Brief summary of the issue"},null,2),[[h,r(a).title]]),r(t).title?(i(),n("p",W,m(r(t).title),1)):g("",!0)]),e("div",null,[o[6]||(o[6]=e("label",{for:"body",class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Description "),e("span",{class:"text-red-500"},"*")],-1)),y(e("textarea",{id:"body","onUpdate:modelValue":o[1]||(o[1]=s=>r(a).body=s),rows:"5",class:x(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":r(t).body}]),placeholder:"Detailed description of the complaint"},null,2),[[h,r(a).body]]),r(t).body?(i(),n("p",Y,m(r(t).body),1)):g("",!0)]),e("div",null,[o[7]||(o[7]=e("label",{for:"authorName",class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Your Name "),e("span",{class:"text-red-500"},"*")],-1)),y(e("input",{id:"authorName","onUpdate:modelValue":o[2]||(o[2]=s=>r(a).authorName=s),type:"text",class:x(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":r(t).authorName}]),placeholder:"Your full name"},null,2),[[h,r(a).authorName]]),r(t).authorName?(i(),n("p",A,m(r(t).authorName),1)):g("",!0)]),e("div",null,[o[9]||(o[9]=e("label",{for:"category",class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Category "),e("span",{class:"text-red-500"},"*")],-1)),y(e("select",{id:"category","onUpdate:modelValue":o[3]||(o[3]=s=>r(a).category=s),class:x(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":r(t).category}])},[o[8]||(o[8]=e("option",{value:""},"Select a category",-1)),(i(),n(V,null,j(u,s=>e("option",{key:s.value,value:s.value},m(s.label),9,J)),64))],2),[[M,r(a).category]]),r(t).category?(i(),n("p",H,m(r(t).category),1)):g("",!0)]),e("div",null,[o[10]||(o[10]=e("label",{for:"location",class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Location "),e("span",{class:"text-red-500"},"*")],-1)),y(e("input",{id:"location","onUpdate:modelValue":o[4]||(o[4]=s=>r(a).location=s),type:"text",class:x(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":r(t).location}]),placeholder:"Street address or area name"},null,2),[[h,r(a).location]]),r(t).location?(i(),n("p",K,m(r(t).location),1)):g("",!0)]),w(p,{ref_key:"imageUploadRef",ref:d},null,512),e("div",Q,[e("button",{type:"submit",disabled:r(c),class:"flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"},m(r(c)?"Submitting...":"Submit Complaint"),9,X),w(S,{to:"/",class:"px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors"},{default:P(()=>[...o[11]||(o[11]=[b(" Cancel ",-1)])]),_:1})])],32)}}}),ee=Object.assign(Z,{__name:"ComplaintForm"}),te={},oe={class:"min-h-screen"},re={class:"bg-white shadow-sm"},ae={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},le={class:"flex items-center gap-4"},se={class:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ie={class:"bg-white shadow-md rounded-lg p-6 md:p-8"};function ne(N,d){const a=F,t=ee;return i(),n("div",oe,[e("header",re,[e("div",ae,[e("div",le,[w(a,{to:"/",class:"text-gray-600 hover:text-gray-900 transition-colors"},{default:P(()=>[...d[0]||(d[0]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1}),d[1]||(d[1]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Submit Complaint"),e("p",{class:"text-gray-600 mt-1"},"Report a civic issue in your community")],-1))])])]),e("main",se,[e("div",ie,[w(t)])])])}const ce=R(te,[["render",ne]]);export{ce as default};
